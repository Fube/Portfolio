---
export const prerender = true;
import Layout from '../layouts/Layout.astro';
import Test from '../components/Test.svelte';
import Navigation from '../components/Navigation.svelte';
import { client } from '../lib/contentful';


/**
 *
 * @param {Promise<contentful.EntryCollection<any>>[]} entryPromises
 * @returns
 */
function getRefinedEntries(...entryPromises) {
	return entryPromises.map((n) => n.then((entry) => entry.items.map((item) => item.fields)));
}

let [projects, whoAmI, about, timeline, cv] = await Promise.all([
    ...getRefinedEntries(
        client.getEntries({
                content_type: 'projects',
                order: 'sys.createdAt'
        }),
        client.getEntries({
                content_type: 'whoami'
        }),
        client.getEntries({
                content_type: 'about'
        }),
        client.getEntries({
                content_type: 'timeline',
                order: 'fields.date'
        })
    ),
    client.getAsset(import.meta.env.CV_ID).then((asset) => asset.fields.file.url)
]);

whoAmI = whoAmI.map(n => n.title)
about = about[0].content.split`--BREAK--`;
---
<Layout>
    <div>
        <Navigation client:idle {cv} />
        <div class="mt-12">
            <Test client:load {whoAmI} {about} {projects} {timeline}/>
        </div>
    </div>
</Layout>

<style>
    body {
        @apply h-screen
    }
</style>
